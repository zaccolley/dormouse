/*! dormouse ~ UP665219 ~ 2014-03-25 */
function updateAll(){updateCategories(),updateItems(),updateBasket()}function addItems(a){var b=JSON.stringify({item:a});ajax({url:"data/add.php",request:"POST",data:b},function(){updateItems()})}function addCategories(a){var b=JSON.stringify({category:a});ajax({url:"data/add.php",request:"POST",data:b},function(){updateCategories()})}function updateCategories(){var a=document.querySelector(".categories");ajax({url:"data/categories.php"},function(b){var c="";b&&""!=b?(b.categories.forEach(function(a){c+="<li><a href='#"+a.toLowerCase()+"'>"+a+"</a></li>"}),b.errors&&""!=b.errors&&(c+="<div class='error-message'>"+b.errors+"</p></div>")):c+="<li><em>Oops&hellip; Can't find any categories!</em> <a href='./' class='no-cats-action'>Try refreshing?</a></li>",a.innerHTML=c})}function updateItems(){var a=document.querySelector(".filter-select"),b=document.querySelector(".search-query"),c=b.value,d=a.value,e={};e.url="data/items.php";var f={};""!=c&&(f.search=c),""!=d&&(f.filter=d),(f.search||f.filter)&&(e.request="POST",e.data=JSON.stringify(f)),ajax(e,function(a){populateItems(a)})}function populateItems(a){var b=document.querySelector(".items");b.innerHTML="";var c="";if(a&&""!=a){for(var d in a.items){var e=a.items[d],f=(document.getElementById("list-display-option"),document.getElementById("grid-display-option")),g="list";f.checked&&(g="grid"),c+="<li class='item-"+g+"' id='item-"+e.id+"'><img src='images/build/"+e.id+".jpg' alt='Image of "+e.name+"'><div class='details'><h1 class='details-title'><a href='#"+e.name+"' title='More details on "+e.name+"?'>"+e.name+"</a></h1><p class='details-desc'>"+e.desc+"</p></div><div class='more-details'><p class='details-cat'>Found in "+e.cat+"</p><p class='details-stock'>"+e.stock+" left</p><p class='details-price'><a href='#"+e.name+"' title='More details on "+e.name+"?'>"+e.price+"</a></p></div></li>"}""!=a.errors&&(c+="<div class='error-message'>"+a.errors+"</p></div>")}else c+="<div class='error-message'><em>Oops&hellip; Can't find any items!</em> <a href='./'>Try refreshing?</a></div>";b.innerHTML=c,itemListeners()}function itemListeners(){var a=document.querySelector(".items");a.addEventListener("click",function(a){if(a.target!=a.currentTarget){for(var b=a.target;-1==b.id.indexOf("item-");)b=b.parentNode;itemId=b.id.substring(5),getPopUpData(itemId)}},!1)}function getPopUpData(a){var b={},c={id:a};b.url="data/popup.php",b.request="POST",b.data=JSON.stringify(c),ajax(b,function(a){populatePopUp(a)}),displayPopUp()}function populatePopUp(a){var b=a.items[0],c=(document.querySelector(".popup"),document.querySelector(".popup__img"));c.setAttribute("src","images/build/"+b.id+".jpg"),c.setAttribute("alt","Image of '"+b.name+"'");var d=document.querySelector(".popup .details");d.innerHTML="<h1 class='details-title'>"+b.name+"</h1>\n			<p class='details-cat'>Found in "+b.cat+"</p>\n			<p class='details-desc'>"+b.desc+"</p>\n			<p class='details-price'>"+b.price+"</p>\n			<p class='details-stock'>"+b.stock+" left</p>"}function displayPopUp(){var a=document.querySelector(".content-container");a.classList.add("blurred");var b=document.querySelector(".popup");b.classList.remove("popup--hidden"),basketClose()}function closePopUp(){{var a=document.querySelector(".popup");document.querySelector(".popup_close")}a.addEventListener("click",function(b){if(b.target==b.currentTarget||"popup_close"==b.target.className||"popup_close"==b.target.parentNode.className){a.classList.add("popup--hidden");var c=document.querySelector(".content-container");c.classList.remove("blurred")}})}function updateBasket(){var a=document.querySelector(".basket-items");ajax({url:"data/basket.json"},function(b){for(var c in b.items){var d=b.items[c];a.innerHTML+="<li class='item-list'><img src='images/build/"+d.id+".jpg' alt='Image of "+d.name+"'><div class='details'><h1 class='details-title'><a href='#"+d.name+"' title='More details on "+d.name+"?'>"+d.name+"</a></h1><p class='details-desc'>"+d.desc+"</p></div><div class='more-details'><p class='details-cat'>Found in "+d.cat+"</p><p class='details-stock'>"+d.stock+" left</p><p class='details-price'><a href='#"+d.name+"' title='More details on "+d.name+"?'>"+d.price+"</a></p></div></li>"}changeCheckoutItemAmount(b.items.length)})}function iconSwap(){var a=document.querySelectorAll(".icon-swap"),b={Search:"search",Grid:"th-large",List:"th-list",Basket:"shopping-cart"};for(var c in a){var d=a[c];if(d.hasOwnProperty("innerHTML")){var e=b[d.innerHTML];d.innerHTML='<i class="fa fa-'+e+'"></i> '+d.innerHTML,d.classList.remove("icon-swap")}}}function basketInit(){var a=document.querySelector(".checkout");a.addEventListener("click",basketToggle,!1)}function basketToggle(){var a=document.querySelector(".checkout"),b=document.querySelector(".basket");a.classList.toggle("checkout-alt"),b.classList.toggle("basket-closed")}function basketClose(){var a=document.querySelector(".checkout"),b=document.querySelector(".basket");a.classList.remove("checkout-alt"),b.classList.add("basket-closed")}function basketOpen(){var a=document.querySelector(".checkout"),b=document.querySelector(".basket");a.classList.remove("checkout-alt"),b.classList.remove("basket-closed")}function displayOptionInit(){var a=document.querySelectorAll(".display-option");document.getElementById("list-display-option-label").style.display="none";for(var b in a){var c=a[b];c.hasOwnProperty("innerHTML")&&c.addEventListener("click",displayOptionToggle,!1)}}function displayOptionToggle(){var a=document.querySelectorAll(".display-option"),b=document.querySelectorAll(".items li"),c="list";for(var d in a){var e=a[d];e.hasOwnProperty("innerHTML")&&(""===e.style.display?(e.style.display="none",c="grid"):(c="list",e.style.display=""))}for(var f in b){var g=b[f];g.hasOwnProperty("innerHTML")&&(g.className="item-"+c)}}function changeCheckoutItemAmount(a){var b=document.querySelector(".checkout-item-amount");a>0?(b.innerHTML=a,document.title="("+a+") "+dormouse.title,b.title="You have "+a+" items, nice! :¬)"):(b.innerHTML=0,document.title=title,b.title="There's nothing here!"),a>=1e3&&(document.title="("+a+") "+dormouse.title,b.innerHTML="999+",b.title="So many items! You have "+a+" items. :¬O")}var ajax=function(a,b){var c,d={request:"GET",url:null,async:!0,dataType:"json",data:null,debug:!1};for(var e in a){var f=a[e];switch(e){case"request":d.request=f;break;case"url":d.url=f;break;case"async":d.async=f;break;case"dataType":d.dataType=f;break;case"data":d.data=f;break;case"debug":d.debug=f;break;default:d.debug&&console.log("Invalid option supplied")}}return d.url?(window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new ActiveXObject("Msxml2.XMLHTTP")),c?(d.debug&&console.log("XMLHttpRequest created"),c.open(d.request,d.url,d.async),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.dataType&&(c.responseType=d.dataType),c.addEventListener("readystatechange",function(){var a=["Uninitialised","Loading","Loaded","Interactive","Complete"];if(d.debug&&console.log("State:",a[c.readyState],c.readyState),4==c.readyState&&(d.debug&&console.log("Status:",c.status,"("+c.statusText+")",'at "'+d.url+'"'),200==c.status)){d.debug&&console.log("Success");var e=c.response;b(e)}}),c.send("data="+d.data),d.debug&&console.log("Data sent: ",d.data),void 0):(d.debug&&console.log("XMLHttpRequest could not be created. :¬("),!1)):(d.debug&&console.log("ajax() requires a URL"),!1)};!function(){dormouse={title:document.title},iconSwap(),displayOptionInit(),basketInit(),closePopUp(),updateAll();var a=document.querySelector("header"),b=a.offsetHeight+"px";document.body.style.marginTop=b}();var filterList=document.querySelector(".filter-select"),searchBox=document.querySelector(".search-query");filterList.addEventListener("change",function(){updateItems()}),searchBox.addEventListener("keyup",function(){updateItems()});
//# sourceMappingURL=script.map.js